# Behind the scenes

This file comes as an ELF:

![image](https://user-images.githubusercontent.com/49762827/215262583-11c6de9b-4ead-493e-972b-8bb320423769.png)

Using strings to take a look at the file to see if the flag can be found in there and nothing jumped out, you could however see these strings which are used in the program:

![image](https://user-images.githubusercontent.com/49762827/215262681-ce828ce4-3a0e-4928-b1f6-247fd8e707f3.png)

Running the file I can see it accepts an input string, anything other than a single string causes it to output one of the above strings seen above:

![image](https://user-images.githubusercontent.com/49762827/215262748-1cdbb3ad-8985-4774-88a4-b65d65dcca2f.png)

Opening it up in Ghidra I can see the main function has only partially decompilled, and stops after calling invalidInstructionException, which has the associated instruction UD2.

![image](https://user-images.githubusercontent.com/49762827/215262942-dd5cb52c-319c-4646-8602-3e79a41e1f6b.png)

Seeing as though the challenge description says they have made decompilation harder, this was an obvious place to start the investigation! A quick google of the UD2 instruction led me to a StackOverflow post where a user comments: gcc sometimes inserts ud2 to mark code areas which exhibit undefined behavior and thus are not supposed to be executed.

This, plus the always true loop it is inside of must mean ghidra isnt decompiling the rest of the function.

Patching this out for a NOP instruction and forcing ghidra to re-decompile the rest of the function, you can see that there are a number of these UD2 instructions which need patching with a NOP.

The result of patching these out is the following decompiliation:

![image](https://user-images.githubusercontent.com/49762827/215263177-2b6ffd80-690b-4792-a57d-887e804388d1.png)

Clearly you can see fragments of a flag in the string inputs. The if statements are testing whether each substring is equal to the hard coded string at position x (where x in incrementing its position), and if so, proceed to the next test. If all tests are passed (strcmp returns 0 when both strings are a match), the flag is returned, which is the string we put into the program!

![image](https://user-images.githubusercontent.com/49762827/215344414-0b97cfc5-dce8-4fd7-a616-7ef51f643d07.png)

